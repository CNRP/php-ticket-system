CREATE DATABASE ticketsystem;

CREATE TABLE IF NOT EXISTS `users` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `first_name` varchar(50) NOT NULL,
 `last_name` varchar(50) NOT NULL,
 `email` varchar(50) NOT NULL,
 `password` varchar(50) NOT NULL,
 `user_id` int(11) DEFAULT '1',
 `create_datetime` datetime NOT NULL,
 PRIMARY KEY (`id`)
);

CREATE TABLE IF NOT EXISTS `tickets` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `order_number` varchar(50) NOT NULL,
 `create_datetime` datetime NOT NULL,
 `status` varchar(50) NOT NULL DEFAULT 'pending',
 `user_id` INT,
 FOREIGN KEY (`user_id`) REFERENCES `users`(`id`),
 PRIMARY KEY (`id`)
);

CREATE TABLE IF NOT EXISTS `ticket_messages` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `message` varchar(500) NOT NULL,
 `create_datetime` datetime NOT NULL,
 `ticket_id` INT,
 `user_id` INT,
 FOREIGN KEY (`ticket_id`) REFERENCES `tickets`(`id`),
 FOREIGN KEY (`user_id`) REFERENCES `users`(`id`),
 PRIMARY KEY (`id`)
);